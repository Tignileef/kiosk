<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ì¢Œì„ ê´€ë¦¬</title>
    <style>
        /* [1] ìŠ¤íƒ€ì¼ ì´ˆê¸°í™” */
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
        
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f1f3f5;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        .kiosk-container {
            width: 100%;
            max-width: 640px;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden; /* í™”ë©´ ì „í™˜ ì‹œ ë„˜ì¹¨ ë°©ì§€ */
        }

        /* â˜… ì‹œì‘ í™”ë©´ (New) */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #2b3044, #1a1d29);
            color: white;
            z-index: 999; /* ì œì¼ ìœ„ì— í‘œì‹œ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: transform 0.5s ease-in-out, opacity 0.5s;
        }
        #start-screen.hidden {
            transform: translateY(-100%); /* ìœ„ë¡œ ìŠ¬ë¼ì´ë“œ ë˜ë©° ì‚¬ë¼ì§ */
            opacity: 0;
            pointer-events: none;
        }

        .logo-area { margin-bottom: 50px; animation: float 3s ease-in-out infinite; }
        .logo-icon { font-size: 5rem; margin-bottom: 10px; display: block; }
        .app-title { font-size: 2rem; font-weight: bold; margin-bottom: 5px; letter-spacing: -1px; }
        .app-subtitle { font-size: 1rem; color: #a5b1c2; font-weight: 300; }

        .touch-area { 
            position: absolute; bottom: 100px; width: 100%; 
            animation: blink 2s infinite; cursor: pointer;
        }
        .touch-text { font-size: 1.2rem; font-weight: 500; }

        @keyframes float { 0% { transform: translateY(0); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }


        /* í—¤ë” */
        header {
            background-color: #2b3044;
            color: white;
            padding: 20px;
        }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* â˜… í™ˆ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (New) */
        .home-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            margin-right: 10px;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .home-btn:active { background: rgba(255,255,255,0.3); }

        .title-wrapper { display: flex; align-items: center; }

        .mode-badge { 
            font-size: 0.8rem; background: #e03131; padding: 4px 8px; 
            border-radius: 4px; font-weight: bold; animation: pulse 1s infinite; 
        }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard { display: flex; gap: 8px; }
        .status-card {
            flex: 1; background-color: #3e445b; padding: 10px 5px;
            border-radius: 8px; text-align: center;
        }
        .status-label { font-size: 0.7rem; color: #ced4da; margin-bottom: 3px; }
        .status-value { font-size: 1.1rem; font-weight: bold; }
        .text-blue { color: #4dabf7; }
        .text-red { color: #ff8787; }

        /* ë©”ì¸ ì˜ì—­ */
        main { flex: 1; padding: 15px; overflow-y: auto; background-color: #f8f9fa; }
        
        .screen-area {
            text-align: center;
            background-color: #e9ecef;
            color: #868e96;
            padding: 8px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: bold;
            letter-spacing: 2px;
        }

        /* ì¢Œì„ ê·¸ë¦¬ë“œ */
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr) 30px repeat(2, 1fr) 30px repeat(2, 1fr);
            gap: 8px 6px;
            padding-bottom: 20px;
        }

        /* ì¢Œì„ ìŠ¤íƒ€ì¼ */
        .seat {
            aspect-ratio: 1/1;
            background-color: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.03);
        }
        .seat-num { font-size: 1.1rem; font-weight: bold; color: #495057; margin-bottom: 2px; }
        .timer { font-size: 0.7rem; color: #e03131; font-weight: bold; font-family: monospace; display: none; }
        .type-badge { font-size: 0.6rem; padding: 2px 4px; border-radius: 3px; margin-bottom: 2px; display: none; }
        
        /* ìƒíƒœë³„ ìŠ¤íƒ€ì¼ */
        .seat.active { background-color: #e7f5ff; border-color: #339af0; }
        .seat.active .seat-num { color: #1864ab; font-size: 1rem; margin-bottom: 0; }
        .seat.active .timer { display: block; }
        .seat.active .type-badge { display: inline-block; }

        .seat.broken { background-color: #f1f3f5; border-color: #ced4da; color: #adb5bd; }
        .seat.broken .seat-num { text-decoration: line-through; opacity: 0.5; }
        .seat.broken::after { content: 'ğŸ”§'; font-size: 1.5rem; position: absolute; }

        .aisle { pointer-events: none; } 
        .badge-major { background-color: #1971c2; color: white; }
        .badge-general { background-color: #fcc419; color: black; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); display: none;
            justify-content: center; align-items: flex-end; z-index: 100;
        }
        .modal-overlay.open { display: flex; }
        .modal-content {
            background-color: white; width: 100%; padding: 30px 20px;
            border-top-left-radius: 25px; border-top-right-radius: 25px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        #toast-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            z-index: 200; display: flex; flex-direction: column; gap: 10px; pointer-events: none;
            width: 90%; max-width: 400px;
        }
        .toast {
            background: rgba(43, 48, 68, 0.95); color: white; padding: 14px 20px;
            border-radius: 12px; font-size: 0.95rem; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            animation: fadeUp 0.3s forwards; display: flex; align-items: center; gap: 10px;
        }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .radio-group { display: flex; gap: 10px; margin: 20px 0; }
        .radio-option {
            flex: 1; text-align: center; border: 2px solid #dee2e6;
            border-radius: 10px; padding: 15px; cursor: pointer;
        }
        .radio-option.selected { border-color: #339af0; background-color: #e7f5ff; color: #1864ab; font-weight: bold; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn { width: 100%; padding: 16px; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 8px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: #339af0; color: white; }
        .btn-danger { background: #ff6b6b; color: white; }
        .btn-warning { background: #ffc078; color: #d9480f; }
        .btn-secondary { background: #e9ecef; color: #495057; }
        .btn-repair { background: #20c997; color: white; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div class="kiosk-container">
        <!-- â˜… ì‹œì‘ í™”ë©´ (New) -->
        <div id="start-screen" onclick="hideStartScreen()">
            <div class="logo-area">
                <span class="logo-icon">ğŸ“</span>
                <div class="app-title">ìŠ¤ë§ˆíŠ¸ ì¢Œì„ ë°°ì •</div>
                <div class="app-subtitle">ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³µí•™ê³¼ ì‹¤ìŠµì‹¤</div>
            </div>
            <div class="touch-area">
                <div class="touch-text">ğŸ‘† í™”ë©´ì„ í„°ì¹˜í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
            </div>
        </div>

        <header>
            <div class="header-top">
                <!-- â˜… í™ˆ ë²„íŠ¼ ì¶”ê°€ -->
                <div class="title-wrapper">
                    <button class="home-btn" onclick="showStartScreen()">ğŸ </button>
                    <div style="font-size:1.2rem; font-weight:bold;">ì¢Œì„ ë°°ì •</div>
                </div>
                <div class="mode-badge">âš¡ ì‹œì—° ëª¨ë“œ (1H=5s)</div>
            </div>
            <div class="dashboard">
                <div class="status-card">
                    <div class="status-label">ì”ì—¬ ì¢Œì„</div>
                    <div class="status-value text-blue" id="remainSeat">36</div>
                </div>
                <div class="status-card">
                    <div class="status-label">ìˆ˜ë¦¬ í•„ìš”</div>
                    <div class="status-value text-red" id="brokenSeat">0</div>
                </div>
                <div class="status-card">
                    <div class="status-label">í˜„ì¬ ì‹œê°</div>
                    <div class="status-value" id="clock">00:00</div>
                </div>
            </div>
        </header>

        <main>
            <div class="screen-area">ğŸ“º SCREEN (FRONT)</div>
            <div class="seat-grid" id="seatGrid">
                <!-- JS ìƒì„± -->
            </div>
        </main>

        <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ -->
        <div id="toast-container"></div>

        <!-- [ëª¨ë‹¬ 1] ì…ì‹¤ ì„ íƒ (ê³ ì¥ì‹ ê³  ë²„íŠ¼ ì œê±°ë¨) -->
        <div id="checkInModal" class="modal-overlay">
            <div class="modal-content">
                <h2 style="margin-bottom:10px;">ì…ì‹¤: ìˆ˜ì—… ìœ í˜• ì„ íƒ</h2>
                <p style="color:#868e96; font-size:0.9rem;">ì´ìš©í•˜ì‹¤ ìˆ˜ì—… ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
                
                <div class="radio-group">
                    <div class="radio-option selected" onclick="selectType('major')" id="opt-major">
                        ì „ê³µ ì‹¬í™”<br>
                        <span style="font-size:0.8rem; color:#339af0;">(2ì‹œê°„ 50ë¶„)</span>
                    </div>
                    <div class="radio-option" onclick="selectType('general')" id="opt-general">
                        êµì–‘/ê¸°íƒ€<br>
                        <span style="font-size:0.8rem; color:#e03131;">(1ì‹œê°„ 50ë¶„)</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="confirmCheckIn()">ì…ì‹¤í•˜ê¸°</button>
                <button class="btn btn-secondary" onclick="closeAllModals()">ì·¨ì†Œ</button>
            </div>
        </div>

        <!-- [ëª¨ë‹¬ 2] í‡´ì‹¤ í™•ì¸ (ê³ ì¥ì‹ ê³  ë²„íŠ¼ ìœ ì§€) -->
        <div id="checkOutModal" class="modal-overlay">
            <div class="modal-content">
                <h2 style="margin-bottom:10px; color:#e03131;">í‡´ì‹¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</h2>
                <p style="color:#495057; font-size:1.1rem; margin-bottom:5px;">
                    í˜„ì¬ ì¢Œì„: <span id="outSeatNum" style="font-weight:bold;">0</span>ë²ˆ
                </p>
                <p style="color:#868e96; font-size:0.9rem; margin-bottom:20px;">
                    ë‚¨ì€ ì‹œê°„: <span id="outRemainTime" style="font-weight:bold; font-family:monospace;">00:00</span>
                </p>
                
                <button class="btn btn-danger" onclick="confirmCheckOut()">í‡´ì‹¤í•˜ê¸° (ì‚¬ìš© ì¢…ë£Œ)</button>
                <button class="btn btn-warning" onclick="openBrokenConfirm()">âš  ê³ ì¥ ì‹ ê³ í•˜ê¸°</button>
                <button class="btn btn-secondary" onclick="closeAllModals()">ê³„ì† ì‚¬ìš©í•˜ê¸°</button>
            </div>
        </div>

        <!-- [ëª¨ë‹¬ 3] ìˆ˜ë¦¬(ë³µêµ¬) í™•ì¸ -->
        <div id="repairModal" class="modal-overlay">
            <div class="modal-content">
                <h2 style="margin-bottom:10px;">ğŸ› ï¸ ê´€ë¦¬ì ë©”ë‰´</h2>
                <p style="color:#495057; margin-bottom:20px;">
                    <span id="repairSeatNum" style="font-weight:bold; color:#e03131;">0</span>ë²ˆ ì¢Œì„ì˜ ìˆ˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆê¹Œ?
                </p>
                <button class="btn btn-repair" onclick="completeRepair()">ìˆ˜ë¦¬ ì™„ë£Œ (ì‚¬ìš© ê°€ëŠ¥ ì²˜ë¦¬)</button>
                <button class="btn btn-secondary" onclick="closeAllModals()">ë‹«ê¸°</button>
            </div>
        </div>

        <!-- [ëª¨ë‹¬ 4] ê³ ì¥ ì‹ ê³  í™•ì¸ -->
        <div id="brokenConfirmModal" class="modal-overlay">
            <div class="modal-content">
                <h2 style="margin-bottom:10px; color:#d9480f;">âš  ì‹ ê³  í™•ì¸</h2>
                <p style="color:#495057; margin-bottom:10px;">
                    <span id="brokenTargetNum" style="font-weight:bold;">0</span>ë²ˆ ì¢Œì„ì„ ê³ ì¥ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                </p>
                <p style="color:#868e96; font-size:0.85rem; margin-bottom:20px;">
                    ì‹ ê³  ì‹œ í•´ë‹¹ ì¢Œì„ì€ 'ìˆ˜ë¦¬ í•„ìš”' ìƒíƒœê°€ ë˜ë©°<br>ì‚¬ìš© ë° ì…ì‹¤ì´ ë¶ˆê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.
                </p>
                <button class="btn btn-danger" onclick="executeBrokenReport()">ì‹ ê³  í™•ì • (ì‚¬ìš© ë¶ˆê°€ ì²˜ë¦¬)</button>
                <button class="btn btn-secondary" onclick="closeAllModals()">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // [1] ì„¤ì •ê°’
        const TIME_MAJOR = 15;
        const TIME_GENERAL = 7;
        
        // [2] ë°ì´í„° ì´ˆê¸°í™”
        const totalSeats = 36;
        let seats = [];
        for(let i=1; i<=totalSeats; i++) {
            seats.push({ 
                id: i, 
                status: 'empty', 
                type: null, 
                remainTime: 0
            });
        }

        let selectedSeatId = null;
        let selectedType = 'major';

        // [3] ì´ˆê¸° ì‹¤í–‰
        renderSeats();
        setInterval(updateClock, 1000);
        setInterval(decrementTimers, 1000);

        // â˜… ì‹œì‘ í™”ë©´ ìˆ¨ê¸°ê¸°/ë³´ì´ê¸° í•¨ìˆ˜
        function hideStartScreen() {
            document.getElementById('start-screen').classList.add('hidden');
        }
        function showStartScreen() {
            document.getElementById('start-screen').classList.remove('hidden');
        }

        // [4] íƒ€ì´ë¨¸ ë¡œì§
        function decrementTimers() {
            let changed = false;
            seats.forEach(seat => {
                if (seat.status === 'active' && seat.remainTime > 0) {
                    seat.remainTime--;
                    
                    if (seat.remainTime <= 0) {
                        seat.status = 'empty';
                        seat.type = null;
                        showToast(`â° ${seat.id}ë²ˆ ì¢Œì„ ì‹œê°„ì´ ì¢…ë£Œë˜ì–´ ìë™ í‡´ì‹¤ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                    }
                    changed = true;
                }
            });
            
            // ëª¨ë‹¬ ì‹œê°„ ê°±ì‹ 
            if(document.getElementById('checkOutModal').style.display === 'flex') {
                const seat = seats.find(s => s.id === selectedSeatId);
                if(seat && seat.status === 'active') {
                    document.getElementById('outRemainTime').innerText = formatTime(seat.remainTime);
                }
            }
            if (changed) renderSeats();
        }

        // [5] ë Œë”ë§ í•¨ìˆ˜
        function renderSeats() {
            const grid = document.getElementById('seatGrid');
            grid.innerHTML = '';
            let activeCount = 0;
            let brokenCount = 0;

            seats.forEach((seat, index) => {
                if (seat.status === 'active') activeCount++;
                if (seat.status === 'broken') brokenCount++;

                const el = document.createElement('div');
                el.className = `seat ${seat.status}`;
                el.onclick = () => handleSeatClick(seat.id);

                let content = `<div class="seat-num">${seat.id}</div>`;
                
                if (seat.status === 'active') {
                    const badgeClass = seat.type === 'major' ? 'badge-major' : 'badge-general';
                    const badgeText = seat.type === 'major' ? 'ì „ê³µ' : 'êµì–‘';
                    content = `
                        <div class="type-badge ${badgeClass}">${badgeText}</div>
                        <div class="seat-num">${seat.id}</div>
                        <div class="timer">${formatTime(seat.remainTime)}</div>
                    `;
                }
                
                el.innerHTML = content;
                grid.appendChild(el);

                // í†µë¡œ ì‚½ì…
                const positionInRow = (index + 1) % 6;
                if (positionInRow === 2 || positionInRow === 4) {
                    const aisle = document.createElement('div');
                    aisle.className = 'aisle';
                    grid.appendChild(aisle);
                }
            });

            document.getElementById('remainSeat').innerText = totalSeats - activeCount - brokenCount;
            document.getElementById('brokenSeat').innerText = brokenCount;
        }

        // [6] ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleSeatClick(id) {
            selectedSeatId = id;
            const seat = seats.find(s => s.id === id);
            
            if (seat.status === 'active') {
                document.getElementById('outSeatNum').innerText = id;
                document.getElementById('outRemainTime').innerText = formatTime(seat.remainTime);
                document.getElementById('checkOutModal').classList.add('open');
            } else if (seat.status === 'broken') {
                document.getElementById('repairSeatNum').innerText = id;
                document.getElementById('repairModal').classList.add('open');
            } else {
                selectedType = 'major';
                updateRadioUI();
                document.getElementById('checkInModal').classList.add('open');
            }
        }

        function selectType(type) {
            selectedType = type;
            updateRadioUI();
        }

        function updateRadioUI() {
            document.getElementById('opt-major').className = `radio-option ${selectedType === 'major' ? 'selected' : ''}`;
            document.getElementById('opt-general').className = `radio-option ${selectedType === 'general' ? 'selected' : ''}`;
        }

        function confirmCheckIn() {
            const seat = seats.find(s => s.id === selectedSeatId);
            seat.status = 'active';
            seat.type = selectedType;
            seat.remainTime = selectedType === 'major' ? TIME_MAJOR : TIME_GENERAL;
            
            closeAllModals();
            renderSeats();
            showToast(`âœ… ${selectedSeatId}ë²ˆ ì¢Œì„ ì…ì‹¤ ì™„ë£Œ`);
        }

        function confirmCheckOut() {
            const seat = seats.find(s => s.id === selectedSeatId);
            seat.status = 'empty';
            seat.type = null;
            seat.remainTime = 0;
            
            closeAllModals();
            renderSeats();
            showToast(`ğŸ‘‹ ${selectedSeatId}ë²ˆ ì¢Œì„ í‡´ì‹¤ ì™„ë£Œ`);
        }

        function openBrokenConfirm() {
            closeAllModals(); // ê¸°ì¡´ ëª¨ë‹¬ ë‹«ê¸°
            document.getElementById('brokenTargetNum').innerText = selectedSeatId;
            document.getElementById('brokenConfirmModal').classList.add('open');
        }

        function executeBrokenReport() {
            const seat = seats.find(s => s.id === selectedSeatId);
            seat.status = 'broken';
            seat.type = null;
            seat.remainTime = 0;
            
            closeAllModals();
            renderSeats();
            showToast(`âš  ${selectedSeatId}ë²ˆ ì¢Œì„ ê³ ì¥ ì‹ ê³  ì ‘ìˆ˜ë¨`);
        }

        function completeRepair() {
            const seat = seats.find(s => s.id === selectedSeatId);
            seat.status = 'empty';
            closeAllModals();
            renderSeats();
            showToast(`ğŸ”§ ${selectedSeatId}ë²ˆ ì¢Œì„ ìˆ˜ë¦¬ ì™„ë£Œ!`);
        }

        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(el => el.classList.remove('open'));
        }

        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = message;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(20px)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
        }

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60).toString().padStart(2, '0');
            const sec = (seconds % 60).toString().padStart(2, '0');
            return `${min}:${sec}`;
        }
    </script>
</body>

</html>
